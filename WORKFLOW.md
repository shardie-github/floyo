# Development Workflow

**Last Updated:** Auto-generated by Autonomous Full-Stack Guardian  
**Status:** Development guidelines and best practices

---

## Git Workflow

### Branch Strategy

- **`main`** - Production-ready code
- **`develop`** - Development branch (optional)
- **`feature/*`** - Feature branches
- **`fix/*`** - Bug fix branches
- **`hotfix/*`** - Critical production fixes

### Commit Messages

Follow conventional commits:

```
feat: Add new integration endpoint
fix: Fix authentication bug
docs: Update API documentation
refactor: Refactor telemetry service
test: Add tests for privacy API
chore: Update dependencies
```

### Pull Request Process

1. **Create feature branch**
   ```bash
   git checkout -b feature/my-feature
   ```

2. **Make changes and commit**
   ```bash
   git add .
   git commit -m "feat: Add new feature"
   ```

3. **Push and create PR**
   ```bash
   git push origin feature/my-feature
   # Create PR on GitHub
   ```

4. **Ensure CI/CD passes**
   - Type checking
   - Linting
   - Tests
   - Build

5. **Get code review**
   - Address review comments
   - Update PR as needed

6. **Merge to main**
   - Squash and merge (preferred)
   - Delete feature branch

---

## Local Development

### Setup

1. **Clone repository**
   ```bash
   git clone <repository-url>
   cd floyo-monorepo
   ```

2. **Install dependencies**
   ```bash
   npm install
   cd frontend && npm install
   ```

3. **Set up environment**
   ```bash
   cp .env.example .env.local
   # Fill in values
   ```

4. **Set up database**
   ```bash
   supabase link --project-ref <project-ref>
   supabase db push
   npm run prisma:generate
   ```

5. **Start development servers**
   ```bash
   # Terminal 1: Frontend
   cd frontend && npm run dev
   
   # Terminal 2: Backend (if needed)
   cd backend && python -m uvicorn main:app --reload
   ```

### Development Commands

```bash
# Type checking
npm run type-check

# Linting
npm run lint
npm run lint:fix

# Formatting
npm run format
npm run format:check

# Testing
npm run test
npm run test:e2e

# Database
npm run prisma:generate
npm run prisma:migrate
npm run prisma:studio
```

---

## Code Quality

### TypeScript

- ✅ Use TypeScript for all new code
- ✅ Enable strict mode
- ✅ Avoid `any` types
- ✅ Use proper type definitions

### Linting

- ✅ Follow ESLint rules
- ✅ Fix linting errors before committing
- ✅ Use Prettier for formatting

### Testing

- ✅ Write tests for new features
- ✅ Maintain test coverage
- ✅ Run tests before committing

### Code Review Checklist

- [ ] Code follows style guidelines
- [ ] Tests pass
- [ ] No linting errors
- [ ] Type checking passes
- [ ] Documentation updated
- [ ] Environment variables documented
- [ ] Security considerations addressed

---

## Environment Management

### Local Development

Use `.env.local` (gitignored):
```bash
cp .env.example .env.local
# Fill in values
```

### Preview Deployments

Environment variables set in Vercel:
- Pull request → Preview environment
- Uses preview environment variables

### Production

Environment variables set in Vercel:
- `main` branch → Production environment
- Uses production environment variables

### Adding New Environment Variables

1. **Add to `.env.example`**
   ```bash
   # New variable
   NEW_VARIABLE=
   ```

2. **Document in `ENVIRONMENT.md`**
   - Add variable description
   - Specify required/optional
   - Note framework compatibility

3. **Set in Vercel**
   - Add to Production environment
   - Add to Preview environment (if needed)

4. **Update code**
   - Use `process.env.NEW_VARIABLE`
   - Add validation if required

---

## Database Migrations

### Creating Migrations

1. **Create migration file**
   ```bash
   supabase migration new add_new_table
   ```

2. **Write migration SQL**
   ```sql
   CREATE TABLE IF NOT EXISTS new_table (
     id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
     ...
   );
   ```

3. **Test migration locally**
   ```bash
   supabase db reset
   ```

4. **Apply to remote**
   ```bash
   supabase db push
   ```

### Migration Best Practices

- ✅ Use `IF NOT EXISTS` for idempotency
- ✅ Use `DROP POLICY IF EXISTS` before creating policies
- ✅ Test migrations on local database first
- ✅ Review migration SQL before applying
- ✅ Backup database before major migrations

---

## Deployment Process

### Automatic Deployment

**Vercel automatically deploys:**
- Push to `main` → Production deployment
- Pull request → Preview deployment

### Manual Deployment

```bash
# Build locally
npm run build

# Deploy to Vercel
vercel deploy --prod
```

### Deployment Checklist

- [ ] All tests pass
- [ ] Environment variables set
- [ ] Database migrations applied
- [ ] Build succeeds
- [ ] Health checks pass
- [ ] Monitor deployment logs

---

## Monitoring & Debugging

### Local Debugging

```bash
# Check logs
npm run dev
# Check browser console
# Check network tab

# Database debugging
npm run prisma:studio
```

### Production Debugging

1. **Check Vercel logs**
   - Go to Vercel Dashboard
   - View function logs
   - Check deployment logs

2. **Check Supabase logs**
   - Go to Supabase Dashboard
   - View database logs
   - Check edge function logs

3. **Check health endpoints**
   ```bash
   curl https://your-app.vercel.app/api/health
   curl https://your-app.vercel.app/api/monitoring/health
   ```

### Error Tracking

- **Sentry** - Automatic error tracking (if configured)
- **Vercel Logs** - Deployment and runtime logs
- **Supabase Logs** - Database and function logs

---

## Security Best Practices

### Code Security

- ✅ Never commit secrets
- ✅ Use environment variables
- ✅ Validate all inputs
- ✅ Sanitize user data
- ✅ Use parameterized queries

### Authentication

- ✅ Use Supabase Auth
- ✅ Validate JWT tokens
- ✅ Check permissions
- ✅ Use RLS policies

### Dependencies

- ✅ Keep dependencies updated
- ✅ Run `npm audit` regularly
- ✅ Review dependency changes
- ✅ Use lock files

---

## Documentation

### Code Documentation

- ✅ Add JSDoc comments for functions
- ✅ Document complex logic
- ✅ Explain "why" not just "what"
- ✅ Keep comments up to date

### API Documentation

- ✅ Document all endpoints in `API.md`
- ✅ Include request/response examples
- ✅ Document error responses
- ✅ Update changelog

### Architecture Documentation

- ✅ Update `ARCHITECTURE.md` for major changes
- ✅ Document design decisions
- ✅ Keep diagrams updated

---

## Troubleshooting

### Common Issues

#### Build Fails

**Check:**
- Environment variables set
- Dependencies installed
- TypeScript errors
- Build logs

**Solution:**
```bash
npm ci
npm run type-check
npm run build
```

#### Database Connection Fails

**Check:**
- `DATABASE_URL` set correctly
- Supabase project active
- Network connectivity

**Solution:**
```bash
supabase status
supabase db remote commit --dry-run
```

#### API Routes Return 500

**Check:**
- Environment variables set
- Supabase connection
- Function logs

**Solution:**
- Check Vercel function logs
- Verify environment variables
- Test locally first

---

## Best Practices Summary

### Do ✅

- ✅ Write tests
- ✅ Follow code style
- ✅ Document changes
- ✅ Review code before merging
- ✅ Use TypeScript
- ✅ Validate inputs
- ✅ Handle errors gracefully

### Don't ❌

- ❌ Commit secrets
- ❌ Skip tests
- ❌ Merge without review
- ❌ Use `any` types
- ❌ Ignore linting errors
- ❌ Deploy without testing
- ❌ Skip documentation

---

## Resources

- **Documentation:** See `/docs` directory
- **Health Reports:** See `/reports` directory
- **Environment Variables:** See `ENVIRONMENT.md`
- **API Reference:** See `API.md`
- **Architecture:** See `ARCHITECTURE.md`

---

## Support

For workflow questions:
- Check documentation
- Review health reports
- Ask team members
- Create issue on GitHub
