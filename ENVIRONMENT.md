# Environment Variables Reference

**Last Updated:** Auto-generated by Autonomous Full-Stack Guardian  
**Status:** âœ… Complete mapping of all environment variables across the stack

This document provides a comprehensive mapping of all environment variables required across:
- **Next.js App Router** (frontend)
- **Supabase** (database, auth, edge functions)
- **Vercel** (deployment, cron jobs)
- **Python Backend** (FastAPI/Flask)
- **External Integrations** (Stripe, TikTok Ads, Meta Ads, Zapier, etc.)

---

## ðŸ”´ CRITICAL - Required for Production

### Database & Supabase Core

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `DATABASE_URL` | All | âœ… | PostgreSQL connection string | Supabase Dashboard > Settings > Database |
| `SUPABASE_URL` | Server-side | âœ… | Supabase project URL | Supabase Dashboard > Settings > API |
| `SUPABASE_ANON_KEY` | Server-side | âœ… | Supabase anonymous key (server) | Supabase Dashboard > Settings > API |
| `SUPABASE_SERVICE_ROLE_KEY` | Server-side | âœ… | Service role key (admin operations) | Supabase Dashboard > Settings > API |
| `NEXT_PUBLIC_SUPABASE_URL` | Next.js Client | âœ… | Supabase URL (public, exposed to client) | Same as SUPABASE_URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Next.js Client | âœ… | Supabase anonymous key (public) | Same as SUPABASE_ANON_KEY |
| `SUPABASE_JWT_SECRET` | Server-side | âš ï¸ | JWT secret for token validation | Supabase Dashboard > Settings > API |

### Security & Authentication

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `SECRET_KEY` | Backend | âœ… | Application secret (min 32 chars) | Generate strong random value |
| `CRON_SECRET` | Vercel/Next.js | âš ï¸ | Secret for authenticated cron endpoints | Generate random value |
| `VERCEL_CRON_SECRET` | Vercel | âš ï¸ | Alternative cron secret name | Same as CRON_SECRET |

---

## ðŸŸ¡ IMPORTANT - Required for Specific Features

### Vercel Deployment

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `VERCEL_TOKEN` | CI/CD | âš ï¸ | Vercel deployment token | Vercel Dashboard > Settings > Tokens |
| `VERCEL_ORG_ID` | CI/CD | âš ï¸ | Vercel organization ID | Vercel Dashboard > Settings |
| `VERCEL_PROJECT_ID` | CI/CD | âš ï¸ | Vercel project ID | Vercel Dashboard > Project Settings |
| `VERCEL_ENV` | Vercel Runtime | Auto | Environment (production/preview/development) | Auto-set by Vercel |

### Supabase CLI & Migrations

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `SUPABASE_ACCESS_TOKEN` | CI/CD | âš ï¸ | Supabase CLI access token | Supabase Dashboard > Account > Access Tokens |
| `SUPABASE_PROJECT_REF` | CI/CD | âš ï¸ | Project reference ID | Supabase Dashboard > Settings > General |

### Payment Processing (Stripe)

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `STRIPE_API_KEY` | Backend | âš ï¸ | Stripe API key | Stripe Dashboard > Developers > API Keys |
| `STRIPE_SECRET_KEY` | Backend | âš ï¸ | Stripe secret key (alternative name) | Same as STRIPE_API_KEY |
| `STRIPE_WEBHOOK_SECRET` | Backend | âš ï¸ | Stripe webhook signing secret | Stripe Dashboard > Webhooks |

---

## ðŸŸ¢ OPTIONAL - Feature-Specific

### Application Configuration

| Variable | Framework | Required | Description | Default |
|----------|-----------|----------|-------------|---------|
| `NODE_ENV` | All | âš ï¸ | Node environment | `development` |
| `ENVIRONMENT` | Backend | âš ï¸ | Application environment | `development` |
| `FRONTEND_URL` | Backend | âš ï¸ | Frontend URL (for email links) | `http://localhost:3000` |
| `NEXT_PUBLIC_API_URL` | Next.js | âš ï¸ | Public API URL | `http://localhost:8000` |
| `NEXT_PUBLIC_SITE_URL` | Next.js | âš ï¸ | Public site URL | `http://localhost:3000` |
| `REVALIDATE_SECONDS` | Next.js | âš ï¸ | ISR revalidation default | `60` |

### Monitoring & Observability

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `SENTRY_DSN` | Backend | âš ï¸ | Sentry DSN for error tracking | Sentry Dashboard |
| `NEXT_PUBLIC_SENTRY_DSN` | Next.js Client | âš ï¸ | Sentry DSN (public) | Sentry Dashboard |
| `NEXT_PUBLIC_POSTHOG_KEY` | Next.js Client | âš ï¸ | PostHog analytics key | PostHog Dashboard |
| `NEXT_PUBLIC_POSTHOG_HOST` | Next.js Client | âš ï¸ | PostHog host | `https://us.i.posthog.com` |

### Feature Flags & Privacy

| Variable | Framework | Required | Description | Default |
|----------|-----------|----------|-------------|---------|
| `PRIVACY_KILL_SWITCH` | Backend | âš ï¸ | Privacy kill switch | `false` |
| `NEXT_PUBLIC_PRIVACY_KILL_SWITCH` | Next.js Client | âš ï¸ | Privacy kill switch (public) | `false` |
| `NEXT_PUBLIC_TRUST_STATUS_PAGE` | Next.js Client | âš ï¸ | Trust status page enabled | `false` |
| `NEXT_PUBLIC_TRUST_HELP_CENTER` | Next.js Client | âš ï¸ | Trust help center enabled | `false` |
| `NEXT_PUBLIC_TRUST_EXPORT` | Next.js Client | âš ï¸ | Trust export enabled | `false` |
| `NEXT_PUBLIC_CSP_ENABLED` | Next.js Client | âš ï¸ | Content Security Policy enabled | `false` |
| `NEXT_PUBLIC_CSP_ALLOWLIST` | Next.js Client | âš ï¸ | CSP allowlist | Empty |

### Integrations

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `NEXT_PUBLIC_HCAPTCHA_SITEKEY` | Next.js Client | âš ï¸ | hCaptcha site key | hCaptcha Dashboard |
| `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME` | Next.js Client | âš ï¸ | Cloudinary cloud name | Cloudinary Dashboard |
| `AWS_ACCESS_KEY_ID` | Backend | âš ï¸ | AWS access key (for exports) | AWS IAM |
| `AWS_SECRET_ACCESS_KEY` | Backend | âš ï¸ | AWS secret key | AWS IAM |
| `AWS_REGION` | Backend | âš ï¸ | AWS region | AWS Console |
| `AWS_S3_BUCKET` | Backend | âš ï¸ | S3 bucket name | AWS S3 |

### Caching & Background Jobs

| Variable | Framework | Required | Description | Default |
|----------|-----------|----------|-------------|---------|
| `REDIS_URL` | Backend | âš ï¸ | Redis connection URL | `redis://localhost:6379/0` |
| `CELERY_BROKER_URL` | Backend | âš ï¸ | Celery broker URL | `redis://localhost:6379/0` |
| `CELERY_RESULT_BACKEND` | Backend | âš ï¸ | Celery result backend | `redis://localhost:6379/0` |

### Admin & Security

| Variable | Framework | Required | Description | Format |
|----------|-----------|----------|-------------|--------|
| `ADMIN_BASIC_AUTH` | Backend | âš ï¸ | Admin basic auth | `username:password` |
| `SNAPSHOT_ENCRYPTION_KEY` | Backend | âš ï¸ | Encryption key for snapshots | Generate random value |

### External Integrations (Referenced but Not Yet Configured)

| Variable | Framework | Required | Description | Status |
|----------|-----------|----------|-------------|--------|
| `TIKTOK_ADS_API_KEY` | Backend | âŒ | TikTok Ads API key | Not configured |
| `TIKTOK_ADS_API_SECRET` | Backend | âŒ | TikTok Ads API secret | Not configured |
| `META_ADS_ACCESS_TOKEN` | Backend | âŒ | Meta Ads API access token | Not configured |
| `META_ADS_APP_ID` | Backend | âŒ | Meta Ads app ID | Not configured |
| `ELEVENLABS_API_KEY` | Backend | âŒ | ElevenLabs API key | Not configured |
| `AUTODS_API_KEY` | Backend | âŒ | AutoDS API key | Not configured |
| `CAPCUT_API_KEY` | Backend | âŒ | CapCut API key | Not configured |
| `ZAPIER_SECRET` | Backend | âŒ | Zapier webhook secret | Not configured |
| `MINSTUDIO_API_KEY` | Backend | âŒ | MindStudio API key | Not configured |

### Infrastructure (CI/CD)

| Variable | Framework | Required | Description | Source |
|----------|-----------|----------|-------------|--------|
| `SUPABASE_DB_URL` | CI/CD | âš ï¸ | Alternative database URL format | Supabase Dashboard |
| `GENERIC_SOURCE_A_TOKEN` | CI/CD | âš ï¸ | Generic source A token | Custom |
| `GENERIC_SOURCE_B_TOKEN` | CI/CD | âš ï¸ | Generic source B token | Custom |
| `SLACK_WEBHOOK_URL` | CI/CD | âš ï¸ | Slack webhook URL | Slack App Settings |
| `TZ` | CI/CD | âš ï¸ | Timezone | `America/Toronto` |
| `API_BASE_URL` | Testing | âš ï¸ | API base URL for tests | `http://localhost:8000` |
| `PROD_URL` | Testing | âš ï¸ | Production URL for tests | `https://your-app.vercel.app` |
| `PARTNER_HMAC_KEY` | Testing | âš ï¸ | Partner HMAC key for tests | Test value |

---

## Framework-Specific Mapping

### Next.js App Router (Client-Side)

**Public Variables (exposed to browser):**
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `NEXT_PUBLIC_API_URL`
- `NEXT_PUBLIC_SITE_URL`
- `NEXT_PUBLIC_SENTRY_DSN`
- `NEXT_PUBLIC_POSTHOG_KEY`
- `NEXT_PUBLIC_POSTHOG_HOST`
- `NEXT_PUBLIC_PRIVACY_KILL_SWITCH`
- `NEXT_PUBLIC_TRUST_STATUS_PAGE`
- `NEXT_PUBLIC_TRUST_HELP_CENTER`
- `NEXT_PUBLIC_TRUST_EXPORT`
- `NEXT_PUBLIC_CSP_ENABLED`
- `NEXT_PUBLIC_CSP_ALLOWLIST`
- `NEXT_PUBLIC_HCAPTCHA_SITEKEY`
- `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME`

**Server-Side Only (API routes, server components):**
- `SUPABASE_URL`
- `SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `SUPABASE_JWT_SECRET`
- `DATABASE_URL`
- `CRON_SECRET`
- `STRIPE_API_KEY`
- `STRIPE_WEBHOOK_SECRET`
- `REDIS_URL`
- `SENTRY_DSN`

### Next.js Edge Runtime

**Edge-compatible variables:**
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`
- `CRON_SECRET`

**Note:** Edge runtime cannot access file system or use Node.js APIs. Use Supabase client or fetch APIs.

### Supabase Edge Functions

**Required:**
- `SUPABASE_URL` (via Deno.env.get)
- `SUPABASE_SERVICE_ROLE_KEY` (via Deno.env.get)

**Note:** Edge functions use Deno runtime. Access via `Deno.env.get('VARIABLE_NAME')`.

### Python Backend (FastAPI/Flask)

**Required:**
- `DATABASE_URL`
- `SECRET_KEY`
- `ENVIRONMENT`

**Optional:**
- `SUPABASE_URL`
- `SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`
- `STRIPE_API_KEY`
- `STRIPE_WEBHOOK_SECRET`
- `REDIS_URL`
- `CELERY_BROKER_URL`
- `CELERY_RESULT_BACKEND`
- `SENTRY_DSN`
- `CORS_ORIGINS`
- `API_HOST`
- `API_PORT`

### Vercel Cron Jobs

**Required:**
- `CRON_SECRET` or `VERCEL_CRON_SECRET` (for authentication)
- `SUPABASE_SERVICE_ROLE_KEY` (for database access)
- `NEXT_PUBLIC_SUPABASE_URL` (for Supabase client)

---

## Environment Setup Instructions

### Local Development

1. **Copy environment template:**
   ```bash
   cp .env.example .env.local
   ```

2. **Fill in values from Supabase Dashboard:**
   - Go to Supabase Dashboard > Settings > API
   - Copy `Project URL` â†’ `SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_URL`
   - Copy `anon public` key â†’ `SUPABASE_ANON_KEY` and `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - Copy `service_role` key â†’ `SUPABASE_SERVICE_ROLE_KEY`
   - Go to Settings > Database â†’ Copy connection string â†’ `DATABASE_URL`

3. **Generate secrets:**
   ```bash
   # Generate SECRET_KEY (32+ characters)
   openssl rand -hex 32
   
   # Generate CRON_SECRET
   openssl rand -hex 16
   ```

4. **Optional: Add Stripe keys** (if using payments)
   - Go to Stripe Dashboard > Developers > API Keys
   - Copy keys to `STRIPE_API_KEY` and `STRIPE_WEBHOOK_SECRET`

### Vercel Deployment

1. **Set environment variables in Vercel Dashboard:**
   - Go to Project Settings > Environment Variables
   - Add all variables listed above (use appropriate environment: Production/Preview/Development)

2. **Or use Vercel CLI:**
   ```bash
   vercel env add SUPABASE_URL production
   vercel env add NEXT_PUBLIC_SUPABASE_URL production
   # ... repeat for all variables
   ```

3. **Pull environment variables locally:**
   ```bash
   vercel env pull .env.local
   ```

### GitHub Secrets (for CI/CD)

Set these in GitHub Repository Settings > Secrets and variables > Actions:

- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`
- `SUPABASE_ANON_KEY`
- `SUPABASE_ACCESS_TOKEN`
- `SUPABASE_PROJECT_REF`
- `VERCEL_TOKEN`
- `VERCEL_ORG_ID`
- `VERCEL_PROJECT_ID`

---

## Validation & Health Checks

### Required Variables Check

Run this script to validate all required variables are set:

```bash
# Check Next.js variables
node -e "
const required = [
  'NEXT_PUBLIC_SUPABASE_URL',
  'NEXT_PUBLIC_SUPABASE_ANON_KEY',
  'SUPABASE_SERVICE_ROLE_KEY'
];
const missing = required.filter(v => !process.env[v]);
if (missing.length) {
  console.error('Missing:', missing);
  process.exit(1);
}
console.log('âœ… All required variables set');
"
```

### Supabase Connection Test

```bash
# Test Supabase connection
curl -H "apikey: $NEXT_PUBLIC_SUPABASE_ANON_KEY" \
  "$NEXT_PUBLIC_SUPABASE_URL/rest/v1/"
```

---

## Security Best Practices

1. **Never commit `.env.local` or `.env` files** (already in `.gitignore`)
2. **Use different keys for development/staging/production**
3. **Rotate secrets regularly** (especially `SECRET_KEY` and `SUPABASE_SERVICE_ROLE_KEY`)
4. **Use Vercel Environment Variables** for production (not `.env` files)
5. **Restrict `SUPABASE_SERVICE_ROLE_KEY`** to server-side only (never expose to client)
6. **Use `CRON_SECRET`** for all cron endpoints to prevent unauthorized access
7. **Validate `SECRET_KEY` length** (minimum 32 characters in production)

---

## Troubleshooting

### "Supabase configuration missing" error

- Check that `SUPABASE_URL` and `SUPABASE_SERVICE_ROLE_KEY` are set
- Verify variables are prefixed correctly (`NEXT_PUBLIC_` for client-side)
- Ensure Vercel environment variables are set for the correct environment

### "Unauthorized" error in cron jobs

- Verify `CRON_SECRET` is set in Vercel environment variables
- Check that cron job includes `Authorization: Bearer ${CRON_SECRET}` header
- Ensure `VERCEL_CRON_SECRET` matches if using alternative name

### Database connection errors

- Verify `DATABASE_URL` is correct PostgreSQL connection string
- Check Supabase project is active and not paused
- Ensure IP allowlist includes Vercel IP ranges (if using IP restrictions)

---

## Change Log

- **2025-01-XX**: Initial comprehensive mapping generated by Autonomous Full-Stack Guardian
- All variables discovered through codebase analysis across Next.js, Supabase, Vercel, and Python backend
