# Architecture Documentation

**Last Updated:** Auto-generated by Autonomous Full-Stack Guardian  
**Status:** System architecture overview

---

## System Overview

Floyo is a full-stack application for tracking file usage patterns and providing AI-powered integration suggestions. The system is built with a modern, scalable architecture using Next.js, Supabase, and Python.

---

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                        Client Layer                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │   Web App    │  │  Mobile App  │  │  API Clients  │   │
│  │  (Next.js)   │  │   (Expo)     │  │   (REST)      │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      API Gateway Layer                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ Next.js API  │  │  Python API  │  │ Supabase Edge │   │
│  │   Routes     │  │  (FastAPI)   │  │   Functions   │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      Data Layer                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │  Supabase    │  │   Redis      │  │   Storage     │   │
│  │  PostgreSQL  │  │   Cache      │  │   (S3/CDN)   │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  Integration Layer                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │    Zapier    │  │  TikTok Ads  │  │  Meta Ads     │   │
│  │  MindStudio  │  │  ElevenLabs  │  │  AutoDS       │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## Component Architecture

### Frontend (Next.js App Router)

```
frontend/
├── app/                    # Next.js App Router
│   ├── api/                # API routes (Edge/Node runtime)
│   ├── dashboard/          # Dashboard pages
│   ├── account/            # Account management
│   ├── privacy/            # Privacy settings
│   └── ...
├── components/             # React components
│   ├── ui/                 # UI primitives
│   ├── integrations/      # Integration components
│   └── ...
├── lib/                    # Utility libraries
│   ├── supabase.ts         # Supabase client
│   ├── api.ts              # API client
│   └── ...
└── hooks/                  # React hooks
```

**Key Features:**
- Server-side rendering (SSR)
- Static site generation (SSG)
- Incremental static regeneration (ISR)
- Edge runtime for API routes
- Progressive Web App (PWA) support

### Backend (Python)

```
backend/
├── api_v1.py              # API routes
├── database.py             # Database connection
├── config.py               # Configuration
├── ml/                     # Machine learning
├── guardian/               # Guardian system
├── notifications/           # Notification system
└── ...
```

**Key Features:**
- RESTful API
- Background job processing (Celery)
- ML model inference
- Rate limiting
- Input validation

### Database (Supabase/PostgreSQL)

```
Database Schema:
├── Core Tables
│   ├── users               # User accounts
│   ├── sessions            # Authentication sessions
│   ├── events              # File system events
│   ├── patterns            # Detected patterns
│   └── ...
├── Privacy Tables
│   ├── privacy_prefs       # Privacy preferences
│   ├── telemetry_events    # Telemetry data
│   └── ...
└── Extended Tables
    ├── organizations       # Organization management
    ├── workflows           # Workflow definitions
    └── ...
```

**Key Features:**
- Row Level Security (RLS)
- Real-time subscriptions
- Edge functions
- Automatic backups

---

## Data Flow

### User Authentication Flow

```
1. User logs in via Supabase Auth
   ↓
2. Supabase returns JWT token
   ↓
3. Token stored in session/cookie
   ↓
4. API requests include token in Authorization header
   ↓
5. Supabase validates token and sets user context
   ↓
6. RLS policies enforce data access
```

### File Event Tracking Flow

```
1. Client detects file event (create/modify/delete)
   ↓
2. Event sent to /api/telemetry/ingest
   ↓
3. API route validates and stores in database
   ↓
4. Background job analyzes patterns
   ↓
5. Suggestions generated based on patterns
   ↓
6. User receives suggestions via real-time subscription
```

### Integration Flow

```
1. User connects external service (e.g., Zapier)
   ↓
2. OAuth flow completes, tokens stored
   ↓
3. Webhook endpoint receives events
   ↓
4. Event processed and stored
   ↓
5. Workflow triggered based on event
   ↓
6. Results stored and user notified
```

---

## Security Architecture

### Authentication & Authorization

- **Supabase Auth** - User authentication
- **JWT Tokens** - Session management
- **Row Level Security (RLS)** - Database-level access control
- **API Route Authentication** - Token validation

### Data Protection

- **Encryption at Rest** - Database encryption
- **Encryption in Transit** - HTTPS/TLS
- **Input Validation** - All inputs validated
- **Rate Limiting** - API rate limits
- **CORS** - Properly configured

### Privacy

- **Privacy-First Design** - User data minimized
- **Consent Management** - User consent tracking
- **Data Retention Policies** - Automatic cleanup
- **Audit Logging** - All actions logged

---

## Deployment Architecture

### Production Deployment

```
GitHub Repository
    ↓
GitHub Actions (CI/CD)
    ↓
┌─────────────────┐
│  Vercel         │  ← Frontend Deployment
│  - Next.js App  │
│  - Edge Runtime │
│  - Cron Jobs    │
└─────────────────┘
    ↓
┌─────────────────┐
│  Supabase       │  ← Database & Backend Services
│  - PostgreSQL   │
│  - Edge Funcs   │
│  - Auth         │
└─────────────────┘
```

### Environment Separation

- **Development** - Local development
- **Preview** - Pull request previews
- **Production** - Live production environment

Each environment has:
- Separate database
- Separate environment variables
- Separate API keys

---

## Integration Architecture

### External Integrations

```
┌─────────────┐
│   Zapier    │  ← Webhook-based automation
└─────────────┘
    ↓
┌─────────────┐
│ TikTok Ads  │  ← OAuth + API integration
└─────────────┘
    ↓
┌─────────────┐
│  Meta Ads   │  ← OAuth + API integration
└─────────────┘
    ↓
┌─────────────┐
│ ElevenLabs  │  ← API integration
└─────────────┘
```

### Integration Pattern

1. **OAuth Flow** (for services requiring OAuth)
   - User initiates connection
   - Redirect to OAuth provider
   - Callback receives tokens
   - Tokens stored securely

2. **Webhook Pattern** (for event-driven integrations)
   - External service sends webhook
   - Webhook authenticated
   - Event processed
   - Workflow triggered

3. **API Polling** (for scheduled data sync)
   - Cron job triggers
   - API called with stored tokens
   - Data fetched and stored
   - Updates processed

---

## Scalability Considerations

### Horizontal Scaling

- **Frontend** - Stateless, scales automatically on Vercel
- **API Routes** - Stateless, scales with traffic
- **Database** - Supabase handles scaling
- **Edge Functions** - Auto-scales with demand

### Caching Strategy

- **Static Assets** - CDN caching (Vercel)
- **API Responses** - Redis caching (optional)
- **Database Queries** - Query optimization + indexes
- **ISR** - Incremental static regeneration

### Performance Optimization

- **Code Splitting** - Automatic with Next.js
- **Image Optimization** - Next.js Image component
- **Bundle Optimization** - Webpack optimizations
- **Database Indexes** - Optimized for query patterns

---

## Monitoring & Observability

### Health Monitoring

- **Application Health** - `/api/health` endpoint
- **Database Health** - Connection monitoring
- **Integration Health** - Webhook delivery tracking

### Error Tracking

- **Sentry** - Error tracking and monitoring
- **Vercel Logs** - Deployment and runtime logs
- **Supabase Logs** - Database and function logs

### Analytics

- **PostHog** - User analytics
- **Vercel Analytics** - Performance analytics
- **Custom Metrics** - Application-specific metrics

---

## Autonomous Systems

### Aurora Prime

Full-stack orchestrator that:
- Validates environment variables
- Checks schema alignment
- Monitors deployment health
- Generates health reports

### Master Omega Prime

Multi-system orchestrator that:
- Coordinates across all systems
- Detects integration issues
- Maintains system alignment
- Provides unified health status

### Autonomous Full-Stack Guardian

Continuous monitoring system that:
- Detects drift automatically
- Fixes issues proactively
- Generates comprehensive reports
- Maintains production readiness

---

## Technology Decisions

### Why Next.js?

- ✅ Server-side rendering for SEO
- ✅ API routes for backend logic
- ✅ Edge runtime for performance
- ✅ Excellent developer experience
- ✅ Built-in optimizations

### Why Supabase?

- ✅ Managed PostgreSQL database
- ✅ Built-in authentication
- ✅ Row Level Security
- ✅ Real-time subscriptions
- ✅ Edge functions

### Why Vercel?

- ✅ Seamless Next.js deployment
- ✅ Edge network for performance
- ✅ Automatic scaling
- ✅ Preview deployments
- ✅ Built-in analytics

---

## Future Considerations

### Planned Enhancements

1. **Microservices Architecture** - Split backend into services
2. **Event-Driven Architecture** - Message queue for events
3. **GraphQL API** - More flexible API layer
4. **Multi-Region Deployment** - Global distribution
5. **Advanced ML Features** - More sophisticated pattern detection

### Scalability Roadmap

- **Phase 1** - Current monolithic architecture
- **Phase 2** - Service separation
- **Phase 3** - Event-driven architecture
- **Phase 4** - Multi-region deployment

---

## Conclusion

This architecture provides:
- ✅ Scalable foundation
- ✅ Secure by default
- ✅ Developer-friendly
- ✅ Production-ready
- ✅ Autonomous maintenance

The system is designed to grow with your needs while maintaining simplicity and reliability.
