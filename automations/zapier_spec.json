{
  "version": "1.0",
  "last_updated": "2025-01-27",
  "description": "High-level Zapier automation recipes for Floyo data pipeline",
  "timezone": "America/Toronto",
  "automations": [
    {
      "name": "Daily Meta Ads Sync",
      "description": "Pull Meta Ads data daily and store in Supabase",
      "trigger": {
        "type": "schedule",
        "frequency": "daily",
        "time": "01:10",
        "timezone": "America/Toronto"
      },
      "actions": [
        {
          "step": 1,
          "app": "Meta Ads",
          "action": "Get Ad Insights",
          "config": {
            "account_id": "{{META_ACCOUNT_ID}}",
            "date_range": "last_7_days",
            "fields": ["spend", "clicks", "impressions", "conversions"]
          }
        },
        {
          "step": 2,
          "app": "Supabase",
          "action": "Upsert Rows",
          "config": {
            "table": "spend",
            "mapping": {
              "platform": "meta",
              "campaign_id": "{{campaign_id}}",
              "adset_id": "{{adset_id}}",
              "date": "{{date}}",
              "spend_cents": "{{spend * 100}}",
              "clicks": "{{clicks}}",
              "impressions": "{{impressions}}",
              "conv": "{{conversions}}"
            }
          }
        }
      ]
    },
    {
      "name": "Daily Shopify Orders Sync",
      "description": "Pull Shopify orders daily and store in Supabase",
      "trigger": {
        "type": "schedule",
        "frequency": "daily",
        "time": "01:20",
        "timezone": "America/Toronto"
      },
      "actions": [
        {
          "step": 1,
          "app": "Shopify",
          "action": "Find Orders",
          "config": {
            "created_at_min": "{{yesterday}}",
            "created_at_max": "{{today}}",
            "status": "any"
          }
        },
        {
          "step": 2,
          "app": "Supabase",
          "action": "Upsert Rows",
          "config": {
            "table": "orders",
            "mapping": {
              "order_number": "{{order_number}}",
              "user_id": "{{customer_id}}",
              "placed_at": "{{created_at}}",
              "items": "{{line_items}}",
              "subtotal_cents": "{{subtotal_price * 100}}",
              "shipping_cents": "{{shipping_price * 100}}",
              "tax_cents": "{{total_tax * 100}}",
              "discount_cents": "{{total_discounts * 100}}",
              "total_cents": "{{total_price * 100}}",
              "currency": "{{currency}}",
              "source": "{{source_name}}"
            }
          }
        }
      ]
    },
    {
      "name": "Daily Metrics Computation",
      "description": "Compute daily metrics after data syncs complete",
      "trigger": {
        "type": "schedule",
        "frequency": "daily",
        "time": "01:30",
        "timezone": "America/Toronto"
      },
      "actions": [
        {
          "step": 1,
          "app": "Supabase",
          "action": "Run SQL",
          "config": {
            "query": "SELECT compute_daily_metrics(CURRENT_DATE - INTERVAL '1 day')"
          }
        }
      ],
      "notes": "This is a fallback. Prefer using the TypeScript ETL script."
    },
    {
      "name": "Retention Email Campaign",
      "description": "Send retention emails based on user behavior",
      "trigger": {
        "type": "filter",
        "condition": "user_signup_date = CURRENT_DATE - INTERVAL '7 days' AND activation = false"
      },
      "actions": [
        {
          "step": 1,
          "app": "Email",
          "action": "Send Email",
          "config": {
            "to": "{{user_email}}",
            "subject": "Create your first workflow",
            "template": "retention_day7"
          }
        }
      ]
    }
  ],
  "notes": "These are high-level recipes. For production, use the TypeScript ETL scripts in /scripts/etl. Zapier can serve as a fallback or for non-technical team members."
}
