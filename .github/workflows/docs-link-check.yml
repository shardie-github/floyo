name: Documentation Link Check

on:
  pull_request:
    paths:
      - 'docs/**/*.md'
      - '*.md'
      - 'yc/**/*.md'
      - 'dataroom/**/*.md'
  push:
    branches: [main]
    paths:
      - 'docs/**/*.md'
      - '*.md'
      - 'yc/**/*.md'
      - 'dataroom/**/*.md'
  schedule:
    # Weekly check on Sundays at 3 AM UTC
    - cron: '0 3 * * 0'
  workflow_dispatch:

jobs:
  check-links:
    name: Check Documentation Links
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install markdown-link-check
        run: npm install -g markdown-link-check

      - name: Check all markdown files
        continue-on-error: true
        run: |
          find . -name "*.md" -not -path "./node_modules/*" -not -path "./.git/*" -not -path "./frontend/node_modules/*" -not -path "./backend/**/*" | while read file; do
            echo "Checking $file"
            markdown-link-check "$file" --config .markdown-link-check.json || true
          done

      - name: Generate link check report
        if: always()
        run: |
          echo "## Documentation Link Check Report" >> $GITHUB_STEP_SUMMARY
          echo "- Checked all markdown files" >> $GITHUB_STEP_SUMMARY
          echo "- See logs above for broken links" >> $GITHUB_STEP_SUMMARY
